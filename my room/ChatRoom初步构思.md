# **ChatRoom初步构思**

![image-20220712115302120](/home/yanran/.config/Typora/typora-user-images/image-20220712115302120.png)

##### 客户端

ChatClient.java -> 客户端窗口

​								发起连接

​								关闭

​								聊天

##### 服务器端

ChatServer.java -> 启动服务器端口并监听

ServerFrame.java -> 服务器窗口

ServerProcess.java -> 服务器与客户端的处理 -> 登陆

​																				   注册

​																			       发送信息

​																				   退出

------



- 用户注册、登陆、注销（7.19设计-----7.20完成）

------



> - ##### 数据库表的构建：
>
> *应该根据系统架构中的组件划分，针对每个组件所处理的业务进行组件单元的数据库设计；不同组件间所对应的数据库表之间的关联应尽可能减少，如果不同组件间的表需要外键关联也尽量不要创建外键关联，而只是记录关联表的一个主键，确保组件对应的表之间的独立性，为系统或表结构的重构提供可能性。*

**群聊列表和好友列表避免一个用户/一个群创建一个表** 

用户数据表 （注册后放到这里面）--> id、username、password、state（初始0为离线，1为在线）

好友列表 （互为好友关系时两人放到此表的同一行里）-->  user1（用户1），user2（用户2），num（属性：0普通好友，1为消息屏蔽好友）

聊天记录的存储用一个表来记录（输入好友名发起聊天） --> time、from_user、end_user、infor

未读消息列表 (离线状态时，没接收的信息存到另一个表里OffLineMessage。接着当用户再次登陆时，主页面显示有几条未读消息，查看之后此表中删除) --> time、me、user、infor

群聊列表 -->  groupname、username、type（身份属性：群主为0，管理员为2，群众为1）

------



- 框架以及页面选项设计（7.20设计-----）

  **问题：**

先启动服务端再启动客户端，两边成功连接后在客户端启动Logn.run()调出用户登陆页面。登陆成功后给服务器端发送XXX上线（**退出登陆同样给服务端发XXX离线，但现在是需要完全退出系统关闭通道，服务端才会报“离线”**）暴力解决了，退出登陆即退出系统。

**不可以同时登陆两个帐号**（解决：数据库中用户表的state，输入用户名之后遍历state值为1的name，如果有重复就显示在线不能重复登陆）

数据库连接应该在服务端

```java
String sql3 = "update client set state=1 where username=?"
ptmt.executeQuery（sql3）;
```

用户登陆后页面显示（登陆成功后将状态改为在线，接收消息只存入“消息历史记录”表中）



**-----------您有？条未读消息-----------**

**（A）好友管理**

​					**查看好友列表**

​					**添加好友**

​					**删除好友**

**（B）聊天群管理**

​					**查看我加入的群列表**

​									***我加入的群***（群众1）--- 列出群列表 --- 请输入想要查看的群名

​									***我创建的群***（群主0）

​												**解散群聊**

​												**添加群管理员**

​												**删除群管理员**

​												查看加入群的群成员列表

​									***我创建的群***（管理员2）

​												查看加入群的群成员列表

​					**创建新的群聊**

​					**申请加入群聊**

​					**退出群聊**

**（C）好友聊天**

​					**发起聊天**

​					**查看聊天记录**

**（D）群聊天**

​					**发起聊天**

​					**查看聊天记录**

**（E）消息管理**

​					**未读消息**（就是离线后收到的消息，结束之后立刻将消息列表清空）

​					**查看好友请求**

​					**查看群通知**

​						**我的群申请 **--- 您已加入群聊.../ 您加入群聊...的申请被驳回

​							**我管理的群通知**（群主0和管理员2能收到）

​									群申请 --- 选择同意/不同意

​									设置管理员通知 ---- 您已被群主设置为群...的管理员 / 您已被群主解除群...管理员身份

​									群友退出 --- XXX退出了群聊

**（F）退出登陆**（将接收消息数据表改为未读消息表，状态改为离线）





